<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>Editar CV</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Fuente -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    :root {
      --primary: #1a73e8;
      --secondary: #0d47a1;
      --dark-bg: #0d1117;
      --dark-card: #161b22;
      --dark-preview: #0c0f14;
      --text-light: #e6edf3;
      --border-dark: #30363d;
    }
    
    body { 
      font-family: 'Poppins', sans-serif; 
      background: var(--dark-bg); 
      color: var(--text-light); 
      margin: 0; 
    }
    
    header { 
      background: linear-gradient(135deg, var(--primary), var(--secondary)); 
      color: #fff; 
      padding: 30px; 
      text-align: center; 
      border-bottom: 5px solid #0c3c84; 
    }
    
    header img { 
      max-height: 80px; 
      margin-bottom: 10px; 
    }
    
    .card { 
      border-radius: 15px; 
      background: var(--dark-card); 
      color: var(--text-light); 
      box-shadow: 0 6px 20px rgba(0,0,0,.6); 
      margin-bottom: 30px; 
      border: none;
    }
    
    .card-header { 
      background: linear-gradient(135deg, var(--primary), var(--secondary)); 
      color: #fff; 
      font-weight: 600; 
      border-radius: 15px 15px 0 0; 
      padding: 15px 20px;
    }
    
    .form-control, .form-select { 
      border-radius: 10px; 
      background: var(--dark-bg); 
      color: var(--text-light); 
      border: 1px solid var(--border-dark); 
      padding: 12px;
    }
    
    .form-control:focus, .form-select:focus { 
      border-color: var(--primary); 
      box-shadow: 0 0 8px rgba(26,115,232,.6); 
      background: var(--dark-bg);
      color: var(--text-light);
    }
    
    .btn-custom { 
      background: linear-gradient(135deg, var(--primary), var(--secondary)); 
      color: #fff; 
      font-weight: 600; 
      border-radius: 10px; 
      transition: .3s; 
      border: none;
      padding: 12px 24px;
    }
    
    .btn-custom:hover { 
      background: linear-gradient(135deg, var(--secondary), var(--primary)); 
      transform: scale(1.05); 
      color: #fff;
    }
    
    .btn-outline-custom {
      color: var(--primary);
      border-color: var(--primary);
      border-radius: 8px;
      padding: 10px 20px;
      font-weight: 600;
      transition: all 0.3s;
    }
    
    .btn-outline-custom:hover {
      background: var(--primary);
      color: white;
    }
    
    .preview-card { 
      border-radius: 15px; 
      background: var(--dark-preview); 
      padding: 20px; 
      box-shadow: 0 8px 25px rgba(0,0,0,.7); 
    }
    
    .preview-title { 
      border-bottom: 2px solid var(--primary); 
      padding-bottom: 8px; 
      margin-bottom: 12px; 
      font-weight: 600; 
      color: #58a6ff; 
    }
    
    .error-message {
      color: #e63946;
      font-size: 0.875em;
      margin-top: 0.25rem;
      display: flex;
      align-items: center;
    }
    
    .error-message i {
      margin-right: 0.5rem;
    }
    
    .form-label {
      font-weight: 500;
      margin-bottom: 0.5rem;
      color: var(--text-light);
    }
  </style>
</head>

<body>

<header>
  <img src="https://media.gettyimages.com/id/1069986632/es/vector/concepto-de-curriculum-y-recursos-humanos.jpg?s=612x612&w=gi&k=20&c=N8IvFOOFBiTKVEmTBqeSi-CdT-TaEgZ6RDqPFcj9jMg=" alt="Logo CV">
  <h1>Editar CV</h1>
  <p>Modifica los datos y visualiza los cambios en tiempo real</p>
</header>

<div class="container my-5">
  <div class="row g-4">
    <!-- Formulario de edición -->
    <div class="col-lg-6">
      <div class="card">
        <div class="card-header"><i class="fas fa-user-edit me-2"></i>Editar información</div>
        <div class="card-body">
          <form th:action="@{/actualizar/{id}(id=${curriculum.id})}" th:object="${curriculum}" method="post" id="cvForm" novalidate>
            <input type="hidden" th:field="*{id}" />
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Primer Nombre *</label>
                <input type="text" class="form-control" th:field="*{nombre1}" placeholder="Ingrese su primer nombre" oninput="updatePreview()">
                <div class="error-message" th:if="${#fields.hasErrors('nombre1')}">
                  <i class="fas fa-exclamation-circle"></i><span th:errors="*{nombre1}"></span>
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Segundo Nombre</label>
                <input type="text" class="form-control" th:field="*{nombre2}" placeholder="Ingrese su segundo nombre" oninput="updatePreview()">
                <div class="error-message" th:if="${#fields.hasErrors('nombre2')}">
                  <i class="fas fa-exclamation-circle"></i><span th:errors="*{nombre2}"></span>
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Primer Apellido *</label>
                <input type="text" class="form-control" th:field="*{apellido1}" placeholder="Ingrese su primer apellido" oninput="updatePreview()">
                <div class="error-message" th:if="${#fields.hasErrors('apellido1')}">
                  <i class="fas fa-exclamation-circle"></i><span th:errors="*{apellido1}"></span>
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Segundo Apellido *</label>
                <input type="text" class="form-control" th:field="*{apellido2}" placeholder="Ingrese su segundo apellido" oninput="updatePreview()">
                <div class="error-message" th:if="${#fields.hasErrors('apellido2')}">
                  <i class="fas fa-exclamation-circle"></i><span th:errors="*{apellido2}"></span>
                </div>
              </div>

              <div class="col-md-6">
                <label class="form-label">Profesión *</label>
                <input type="text" class="form-control" th:field="*{profesion}" placeholder="Ingrese su profesión" oninput="updatePreview()">
                <div class="error-message" th:if="${#fields.hasErrors('profesion')}">
                  <i class="fas fa-exclamation-circle"></i><span th:errors="*{profesion}"></span>
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Fecha de Nacimiento *</label>
                <input type="date" class="form-control" th:field="*{fechaNacimiento}" oninput="updatePreview()">
                <div class="error-message" th:if="${#fields.hasErrors('fechaNacimiento')}">
                  <i class="fas fa-exclamation-circle"></i><span th:errors="*{fechaNacimiento}"></span>
                </div>
                <div class="error-message" th:if="${#fields.hasErrors('edadValida')}">
                  <i class="fas fa-exclamation-circle"></i><span th:errors="*{edadValida}"></span>
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Sexo *</label>
                <select class="form-select" th:field="*{sexo}" oninput="updatePreview()">
                  <option value="" disabled>Seleccione...</option>
                  <option value="Hombre">Hombre</option>
                  <option value="Mujer">Mujer</option>
                  <option value="Prefiero no decir">Prefiero no decir</option>
                </select>
                <div class="error-message" th:if="${#fields.hasErrors('sexo')}">
                  <i class="fas fa-exclamation-circle"></i><span th:errors="*{sexo}"></span>
                </div>
              </div>
              <div class="col-md-6" style="position: relative;">
                <label class="form-label">País *</label>
                <input type="text" id="pais" th:field="*{pais}" class="form-control" placeholder="Escriba su país..." oninput="updatePreview()">
                <div id="pais-list" class="list-group" style="position: absolute; z-index: 1000; width: 100%;"></div>
                <div class="error-message" th:if="${#fields.hasErrors('pais')}">
                  <i class="fas fa-exclamation-circle"></i><span th:errors="*{pais}"></span>
                </div>
              </div>

              <div class="col-md-6">
                <label class="form-label">Ciudad</label>
                <input type="text" class="form-control" th:field="*{ciudad}" placeholder="Ingrese su ciudad" oninput="updatePreview()">
              </div>
              <div class="col-md-6">
                <label class="form-label">Cédula *</label>
                <input type="text" class="form-control" th:field="*{cedula}" placeholder="Ej: 123-456.789" oninput="updatePreview()">
                <div class="error-message" th:if="${#fields.hasErrors('cedula')}">
                  <i class="fas fa-exclamation-circle"></i><span th:errors="*{cedula}"></span>
                </div>
                <div class="error-message" th:if="${#fields.hasErrors('cedulaFormatoValido')}">
                  <i class="fas fa-exclamation-circle"></i><span th:errors="*{cedulaFormatoValido}"></span>
                </div>
              </div>
              <div class="col-12">
                <label class="form-label">Dirección</label>
                <input type="text" class="form-control" th:field="*{direccion}" placeholder="Ingrese su dirección" oninput="updatePreview()">
                <div class="error-message" th:if="${#fields.hasErrors('direccion')}">
                  <i class="fas fa-exclamation-circle"></i><span th:errors="*{direccion}"></span>
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Estado Civil *</label>
                <select class="form-select" th:field="*{estadoCivil}" oninput="updatePreview()">
                  <option value="" disabled>Seleccione...</option>
                  <option value="Soltero">Soltero</option>
                  <option value="Casado">Casado</option>
                  <option value="Divorciado">Divorciado</option>
                  <option value="Viudo">Viudo</option>
                  <option value="Unión libre">Unión libre</option>
                  <option value="Prefiero no decir">Prefiero no decir</option>
                </select>
                <div class="error-message" th:if="${#fields.hasErrors('estadoCivil')}">
                  <i class="fas fa-exclamation-circle"></i><span th:errors="*{estadoCivil}"></span>
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Email *</label>
                <input type="email" class="form-control" th:field="*{email}" placeholder="ejemplo@dominio.com" oninput="updatePreview()">
                <div class="error-message" th:if="${#fields.hasErrors('email')}">
                  <i class="fas fa-exclamation-circle"></i><span th:errors="*{email}"></span>
                </div>
                <div class="error-message" th:if="${#fields.hasErrors('emailFormatoValido')}">
                  <i class="fas fa-exclamation-circle"></i><span th:errors="*{emailFormatoValido}"></span>
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Teléfono</label>
                <input type="text" class="form-control" th:field="*{telefono}" placeholder="Ingrese su teléfono" oninput="updatePreview()">
                <div class="error-message" th:if="${#fields.hasErrors('telefono')}">
                  <i class="fas fa-exclamation-circle"></i><span th:errors="*{telefono}"></span>
                </div>
              </div>

              <div class="col-12">
                <label class="form-label">Experiencia</label>
                <textarea class="form-control" th:field="*{experiencia}" rows="3" placeholder="Describa su experiencia" oninput="updatePreview()"></textarea>
                <div class="error-message" th:if="${#fields.hasErrors('experiencia')}">
                  <i class="fas fa-exclamation-circle"></i><span th:errors="*{experiencia}"></span>
                </div>
              </div>
              <div class="col-12">
                <label class="form-label">Habilidades</label>
                <textarea class="form-control" th:field="*{habilidades}" rows="2" placeholder="Enumere sus habilidades" oninput="updatePreview()"></textarea>
                <div class="error-message" th:if="${#fields.hasErrors('habilidades')}">
                  <i class="fas fa-exclamation-circle"></i><span th:errors="*{habilidades}"></span>
                </div>
              </div>

              <div class="col-12 d-flex justify-content-between">
                <a th:href="@{/}" class="btn btn-outline-custom">
                  <i class="fas fa-arrow-left me-1"></i> Cancelar
                </a>
                <button type="submit" class="btn btn-custom">
                  <i class="fas fa-save me-1"></i> Actualizar
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Vista previa -->
    <div class="col-lg-6">
      <div class="preview-card">
        <h3 class="preview-title"><i class="fas fa-eye me-2"></i>Vista Previa del CV</h3>
        <div class="row">
          <div class="col-md-6">
            <h5 class="preview-title">Datos Personales</h5>
            <p><strong>Nombre Completo:</strong> <span id="previewNombre"></span></p>
            <p><strong>Profesión:</strong> <span id="previewProfesion"></span></p>
            <p><strong>Fecha Nacimiento:</strong> <span id="previewFecha"></span></p>
            <p><strong>Sexo:</strong> <span id="previewSexo"></span></p>
          </div>
          <div class="col-md-6">
            <h5 class="preview-title">Ubicación</h5>
            <p><strong>País:</strong> <span id="previewPais"></span></p>
            <p><strong>Ciudad:</strong> <span id="previewCiudad"></span></p>
            <p><strong>Dirección:</strong> <span id="previewDireccion"></span></p>
          </div>
        </div>
        
        <h5 class="preview-title">Contacto</h5>
        <div class="row">
          <div class="col-md-6">
            <p><strong>Cédula:</strong> <span id="previewCedula"></span></p>
          </div>
          <div class="col-md-6">
            <p><strong>Estado Civil:</strong> <span id="previewEstadoCivil"></span></p>
          </div>
          <div class="col-md-6">
            <p><strong>Email:</strong> <span id="previewEmail"></span></p>
          </div>
          <div class="col-md-6">
            <p><strong>Teléfono:</strong> <span id="previewTelefono"></span></p>
          </div>
        </div>
        
        <h5 class="preview-title">Experiencia</h5>
        <p id="previewExperiencia"></p>
        
        <h5 class="preview-title">Habilidades</h5>
        <p id="previewHabilidades"></p>
      </div>
    </div>
  </div>
</div>

<script th:src="@{/js/script.js}"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
// === Autocomplete país usando REST Countries API ===
document.addEventListener("DOMContentLoaded", function () {
    const paisInput = document.getElementById("pais");
    const paisList = document.getElementById("pais-list");

    paisInput.addEventListener("input", function () {
        const query = this.value.trim();
        paisList.innerHTML = "";

        if (query.length < 1) return;

        fetch(`https://restcountries.com/v3.1/name/${query}`)
            .then(res => res.json())
            .then(data => {
                data.forEach(country => {
                    const item = document.createElement("button");
                    item.type = "button";
                    item.className = "list-group-item list-group-item-action";
                    item.textContent = country.name.common;
                    item.addEventListener("click", () => {
                        paisInput.value = country.name.common;
                        paisList.innerHTML = "";
                        updatePreview();
                    });
                    paisList.appendChild(item);
                });
            })
            .catch(err => {
                paisList.innerHTML = "";
            });
    });

    document.addEventListener("click", function (e) {
        if (!paisInput.contains(e.target)) {
            paisList.innerHTML = "";
        }
    });

    // Inicializar vista previa
    updatePreview();
});

// === Vista previa en tiempo real ===
function updatePreview() {
    // Obtener valores de los campos
    const nombre1 = document.querySelector('[th\\:field*="nombre1"]')?.value || '';
    const nombre2 = document.querySelector('[th\\:field*="nombre2"]')?.value || '';
    const apellido1 = document.querySelector('[th\\:field*="apellido1"]')?.value || '';
    const apellido2 = document.querySelector('[th\\:field*="apellido2"]')?.value || '';
    const profesion = document.querySelector('[th\\:field*="profesion"]')?.value || '';
    const fechaNacimiento = document.querySelector('[th\\:field*="fechaNacimiento"]')?.value || '';
    const sexo = document.querySelector('[th\\:field*="sexo"]')?.value || '';
    const pais = document.getElementById('pais')?.value || '';
    const ciudad = document.querySelector('[th\\:field*="ciudad"]')?.value || '';
    const cedula = document.querySelector('[th\\:field*="cedula"]')?.value || '';
    const direccion = document.querySelector('[th\\:field*="direccion"]')?.value || '';
    const estadoCivil = document.querySelector('[th\\:field*="estadoCivil"]')?.value || '';
    const email = document.querySelector('[th\\:field*="email"]')?.value || '';
    const telefono = document.querySelector('[th\\:field*="telefono"]')?.value || '';
    const experiencia = document.querySelector('[th\\:field*="experiencia"]')?.value || '';
    const habilidades = document.querySelector('[th\\:field*="habilidades"]')?.value || '';

    // Actualizar vista previa
    document.getElementById('previewNombre').textContent = `${nombre1} ${nombre2} ${apellido1} ${apellido2}`.trim() || '-';
    document.getElementById('previewProfesion').textContent = profesion || '-';
    document.getElementById('previewFecha').textContent = fechaNacimiento || '-';
    document.getElementById('previewSexo').textContent = sexo || '-';
    document.getElementById('previewPais').textContent = pais || '-';
    document.getElementById('previewCiudad').textContent = ciudad || '-';
    document.getElementById('previewCedula').textContent = cedula || '-';
    document.getElementById('previewDireccion').textContent = direccion || '-';
    document.getElementById('previewEstadoCivil').textContent = estadoCivil || '-';
    document.getElementById('previewEmail').textContent = email || '-';
    document.getElementById('previewTelefono').textContent = telefono || '-';
    document.getElementById('previewExperiencia').textContent = experiencia || '-';
    document.getElementById('previewHabilidades').textContent = habilidades || '-';
}

// Validación del formulario antes de enviar
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('cvForm');
    if (form) {
        form.addEventListener('submit', function(e) {
            let isValid = true;
            let firstError = null;
            
            // Validar campos requeridos
            const requiredFields = form.querySelectorAll('[required]');
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    isValid = false;
                    if (!firstError) firstError = field;
                    field.classList.add('is-invalid');
                } else {
                    field.classList.remove('is-invalid');
                }
            });
            
            if (!isValid) {
                e.preventDefault();
                // Desplazarse al primer error
                if (firstError) {
                    firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
        });
    }
});
</script>
</body>
</html>